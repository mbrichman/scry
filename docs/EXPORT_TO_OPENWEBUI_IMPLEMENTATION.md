# Export to OpenWebUI - Implementation Summary

## Overview
Added functionality to export conversations from DovOS directly to OpenWebUI with a single button click.

## Files Modified

### 1. `config.py`
- Added `OPENWEBUI_URL` configuration
- Added `OPENWEBUI_API_KEY` configuration

### 2. `requirements.txt`
- Added `requests` library (for HTTP API calls)

### 3. `controllers/conversation_controller.py`
- Added `export_to_openwebui(doc_id)` method to `ConversationController` class
  - Retrieves conversation from database
  - Parses messages using existing `_parse_conversation_messages()` method
  - Converts to OpenWebUI format using `claude_to_openwebui_converter.py`
  - Sends to OpenWebUI via API
  - Returns JSON response with success/error status

### 4. `routes.py`
- Added new route: `POST /export_to_openwebui/<doc_id>`

### 5. `templates/view.html`
- Added "Export to OpenWebUI" button in the action buttons section
- Added JavaScript function `exportToOpenWebUI(conversationId)`
  - Handles button state (disabled, loading spinner)
  - Makes POST request to export endpoint
  - Displays success/error notifications
  - Resets button state after completion
- Added helper function `showNotification(message, type)` for user feedback

## New Files Created

### 1. `OPENWEBUI_EXPORT.md`
- User documentation for the export feature
- Configuration instructions
- Troubleshooting guide

### 2. `test_openwebui_connection.py`
- Test script to verify OpenWebUI connectivity
- Tests API endpoint availability
- Validates API key

## How It Works

1. **User Action**: User clicks "Export to OpenWebUI" button on conversation view
2. **Frontend**: JavaScript sends POST request to `/export_to_openwebui/<conversation_id>`
3. **Backend**: 
   - Retrieves conversation from ChromaDB
   - Parses conversation into structured messages
   - Converts to OpenWebUI format using existing converter
   - Sends to OpenWebUI API endpoint
4. **Response**: Success/error message displayed to user

## UI Features

- Green "Export to OpenWebUI" button next to "Export as Markdown"
- Loading spinner during export
- Button text changes: "Export to OpenWebUI" → "Exporting..." → "Exported!" or "Export Failed"
- Notification banner with success/error message
- Auto-reset after 2-3 seconds

## API Integration

**Endpoint Used**: `POST {OPENWEBUI_URL}/api/v1/chats/import`

**Authentication**: Bearer token via API key

**Payload**: OpenWebUI conversation JSON format (generated by converter)

**Response Handling**:
- 200: Success
- Other: Error with status code and detail

## Error Handling

- Connection errors (network, timeout)
- API errors (invalid key, server errors)
- Conversion errors (unsupported format)
- All errors displayed to user with helpful messages

## Testing

Run the test script to verify your OpenWebUI connection:

```bash
cd /Users/markrichman/projects/dovos
source venv/bin/activate
python test_openwebui_connection.py
```

## Configuration

To change OpenWebUI server settings:

1. Edit `config.py`
2. Update `OPENWEBUI_URL` and `OPENWEBUI_API_KEY`
3. Restart Flask app

## Dependencies

- `requests` library (for HTTP calls)
- Existing `claude_to_openwebui_converter.py` (for format conversion)
- Bootstrap CSS (for button and spinner styling)

## Browser Compatibility

- Modern browsers with fetch API support
- async/await support required
- Tested with Chrome, Firefox, Safari

## Security Considerations

- API key stored in config.py (should use environment variables in production)
- HTTPS recommended for OpenWebUI connection
- CORS may need configuration on OpenWebUI side

## Future Enhancements

Potential improvements:
- Batch export (multiple conversations)
- Export from conversation list view
- Export history/logs
- Configurable model selection
- Export preview before sending
- Environment variable support for API key
